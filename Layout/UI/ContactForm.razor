@using System.Text.Json

<div class="contact-form">
	<EditForm class="contact-form__holder" Model="_formModel" OnValidSubmit="HandleValidSubmit" Enhance>
		<DataAnnotationsValidator />

		<h2 class="contact-form__title">Let's Collaborate</h2>

		<p class="contact-form__subtitle">
			I'm excited to hear about your project and how we can create something amazing together. Whether you have
			questions, ideas, or just want to say hello, feel free to reach out!
		</p>

		<div class="contact-form__fields">
			<div class="contact-form__group">
				<InputText class="contact-form__input" placeholder="First name" @bind-Value="_formModel.FirstName" />
			</div>

			<div class="contact-form__group">
				<InputText class="contact-form__input" placeholder="Last name" @bind-Value="_formModel.LastName" />
			</div>

			<div class="contact-form__group">
				<InputText class="contact-form__input" placeholder="Email address" @bind-Value="_formModel.Email" />
			</div>

			<div class="contact-form__group">
				<InputText class="contact-form__input" placeholder="Phone number" @bind-Value="_formModel.Phone" />
			</div>

			<!-- Service Selection as Searchable Card Radio Buttons -->
			<div class="contact-form__group contact-form__group--full">
				<label class="contact-form__label" for="serviceSearch">Select a service</label>

				<input id="serviceSearch" type="text" placeholder="Search services..." class="contact-form__search"
					@bind="serviceSearch" @bind:event="oninput" />

				<div class="contact-form__radio-group">
					@foreach (var service in FilteredServices)
					{
						<label class="contact-form__radio-card">
							<input type="radio" name="service" value="@service" @onchange="() => OnServiceSelected(service)"
								checked="@(service == _formModel.Service)" />
							<div class="contact-form__radio-content">@service</div>
						</label>
					}
				</div>
			</div>

			<div class="contact-form__group contact-form__group--full">
				<InputTextArea class="contact-form__textarea" placeholder="Type your message here."
					@bind-Value="_formModel.Message" />
			</div>
		</div>

		<div class="contact-form__error-wrapper">
			<ValidationSummary class="contact-form__error" />
		</div>

		<button type="submit" class="contact-form__submit">Send message</button>
	</EditForm>
</div>

@code {
	[Parameter, EditorRequired] public List<string> ServicesNames { get; set; } = new();

	[Parameter] public string SelectedService { get; set; } = "";

	private ContactFormModel _formModel = new();

	private string serviceSearch = "";

	protected override void OnInitialized()
	{
		if (!string.IsNullOrEmpty(SelectedService))
		{
			_formModel.Service = SelectedService;
		}
	}

	private IEnumerable<string> FilteredServices =>
	string.IsNullOrWhiteSpace(serviceSearch)
	? ServicesNames
	: ServicesNames.Where(s => s.Contains(serviceSearch, StringComparison.OrdinalIgnoreCase));

	private void OnServiceSelected(string selectedService)
	{
		_formModel.Service = selectedService;
	}

	private void HandleValidSubmit()
	{
		Console.WriteLine(JsonSerializer.Serialize(_formModel));
	}

	public class ContactFormModel
	{
		public string FirstName { get; set; } = "";
		public string LastName { get; set; } = "";
		public string Email { get; set; } = "";
		public string Phone { get; set; } = "";
		public string Service { get; set; } = "";
		public string Message { get; set; } = "";
	}
}
